<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="twitter:card" content="card" />
  <meta name="twitter:site" content="@abazlinton" />
  <meta name="twitter:title" content="Terrain Generator" />
  <meta name="twitter:description" content="Generate realistic looking terrain" />
  <meta name="twitter:image" content="https://demos-iota.vercel.app/preview.png" />
  <title>Terrain Generator</title>
  <script src="terrain.js"></script>
</head>

<body>
  <h1 style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">Click terrain to regenerate</h1>
  <canvas onclick="redraw()" id="canvas" width="1200" height="1200" ></canvas>
 
</body>
<script>

  const terrainPallette = [
    '#FFFFFF',
    '#9C6608',
    '#885916',
    '#734C23',
    '#5F3E31',
    '#4A313E',
    '#506C2D',
    '#506C2D',
    '#527025',
    '#528225',
    '#344793',
    '#273783',
    '#0D1763',
    '#000539',
    '#000539',
    '#000539',
  ]
  redraw()
  function redraw() {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const terrain = new Terrain()
    const power = 9
    const size = 2 ** power
    terrain.init(size + 1)
    terrain.set(0, 0,0)
    terrain.set(0, size, 0)
    terrain.set(size, size, 0)
    terrain.set(size, 0, 0)
    terrain.run(size + 1)
    const squareSize = 1
    // debugger
    console.log(terrain.grid.flat().length)
    const allHeights = terrain.grid.flat()
    const max = allHeights.reduce((highest, current) => current > highest ? current : highest)
    const min = allHeights.reduce((lowest, current) => current < lowest ? current : lowest)

    console.log(max, min, max - min)
    terrain.grid.forEach((col, y) => col.forEach((cell, x) => {
      const gradient = cell / max * 256
      let gradientIndex = Math.floor(terrainPallette.length - cell / max * terrainPallette.length * 1.1)
      if (gradientIndex < 0) gradientIndex = 0
      if (gradientIndex >= terrainPallette.length) gradientIndex = terrainPallette.length - 1

      const rgb = terrainPallette[gradientIndex]
      ctx.fillStyle = rgb
      // ctx.fillStyle = `rgb(${gradient}, ${gradient},${gradient})`
      ctx.fillRect(x * squareSize, y * squareSize, squareSize, squareSize)
    }))
  }

</script>
</html>